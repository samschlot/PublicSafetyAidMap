console.log("✅ mapscript.js loaded");

// Initialize map
const map = L.map("map").setView([46.7296, -94.6859], 6);

// Minimal base map (Carto Light)
L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
  attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/">CARTO</a>',
  subdomains: "abcd",
  maxZoom: 19
}).addTo(map);

// Aid data object (name -> Public Safety Aid Amount)
const aidData = {"Ada": "$75,224",
"Adams": "$30,151",
"Adrian": "$52,162",
"Afton": "$129,793",
"Aitkin": "$96,098",
"Akeley": "$18,204",
"Albany": "$122,616",
"Albert Lea": "$800,857",
"Alberta": "$4,026",
"Albertville": "$349,995",
"Alden": "$25,162",
"Aldrich": "$1,532",
"Alexandria": "$642,839",
"Alpha": "$4,420",
"Altura": "$20,436",
"Alvarado": "$16,979",
"Amboy": "$23,280",
"Andover": "$1,431,312",
"Annandale": "$148,216",
"Anoka": "$789,480",
"Apple Valley": "$2,464,493",
"Appleton": "$61,746",
"Arco": "$3,763",
"Arden Hills": "$433,096",
"Argyle": "$23,937",
"Arlington": "$99,773",
"Ashby": "$20,611",
"Askov": "$14,572",
"Atwater": "$48,968",
"Audubon": "$24,243",
"Aurora": "$73,867",
"Austin": "$1,159,298",
"Avoca": "$4,814",
"Avon": "$72,073",
"Babbitt": "$60,564",
"Backus": "$11,728",
"Badger": "$18,598",
"Bagley": "$56,626",
"Balaton": "$25,819",
"Barnesville": "$121,829",
"Barnum": "$27,350",
"Barrett": "$16,148",
"Barry": "$700",
"Battle Lake": "$37,371",
"Baudette": "$42,447",
"Baxter": "$389,948",
"Bayport": "$167,427",
"Beardsley": "$9,452",
"Beaver Bay": "$5,339",
"Beaver Creek": "$12,209",
"Becker": "$217,051",
"Bejou": "$3,895",
"Belgrade": "$32,383",
"Belle Plaine": "$322,645",
"Bellechester": "$7,702",
"Bellingham": "$6,477",
"Beltrami": "$3,807",
"Belview": "$12,603",
"Bemidji": "$662,837",
"Bena": "$6,608",
"Benson": "$154,430",
"Bertha": "$24,243",
"Bethel": "$20,655",
"Big Falls": "$7,571",
"Big Lake": "$532,344",
"Bigelow": "$9,846",
"Bigfork": "$17,460",
"Bingham Lake": "$6,083",
"Birchwood Village": "$37,809",
"Bird Island": "$43,760",
"Biscay": "$4,945",
"Biwabik": "$42,010",
"Blackduck": "$36,759",
"Blaine": "$3,106,062",
"Blomkest": "$6,389",
"Blooming Prairie": "$85,683",
"Bloomington": "$3,981,050",
"Blue Earth": "$138,151",
"Bluffton": "$9,102",
"Bock": "$3,326",
"Borup": "$4,420",
"Bovey": "$35,971",
"Bowlus": "$12,122",
"Boy River": "$1,138",
"Boyd": "$6,170",
"Braham": "$77,981",
"Brainerd": "$642,357",
"Brandon": "$21,968",
"Breckenridge": "$146,291",
"Breezy Point": "$116,709",
"Brewster": "$21,968",
"Bricelyn": "$15,097",
"Brook Park": "$5,820",
"Brooklyn Center": "$1,469,690",
"Brooklyn Park": "$3,768,024",
"Brooks": "$5,207",
"Brookston": "$5,120",
"Brooten": "$27,744",
"Browerville": "$36,452",
"Browns Valley": "$24,112",
"Brownsdale": "$28,182",
"Brownsville": "$24,725",
"Brownton": "$31,989",
"Bruno": "$3,807",
"Buckman": "$13,566",
"Buffalo": "$716,706",
"Buffalo Lake": "$28,707",
"Buhl": "$41,879",
"Burnsville": "$2,828,097",
"Burtrum": "$5,339",
"Butterfield": "$26,081",
"Byron": "$286,761",
"Caledonia": "$124,323",
"Callaway": "$8,446",
"Calumet": "$14,485",
"Cambridge": "$431,564",
"Campbell": "$6,958",
"Canby": "$72,730",
"Cannon Falls": "$185,369",
"Canton": "$13,653",
"Carlos": "$21,793",
"Carlton": "$42,054",
"Carver": "$256,479",
"Cass Lake": "$30,063",
"Cedar Mills": "$2,757",
"Center City": "$27,963",
"Centerville": "$171,190",
"Ceylon": "$13,172",
"Champlin": "$1,040,883",
"Chandler": "$12,078",
"Chanhassen": "$1,134,967",
"Chaska": "$1,222,269",
"Chatfield": "$131,719",
"Chickamaw Beach": "$5,689",
"Chisago City": "$246,458",
"Chisholm": "$207,074",
"Chokio": "$17,329",
"Circle Pines": "$217,664",
"Clara City": "$61,790",
"Claremont": "$22,318",
"Clarissa": "$28,751",
"Clarkfield": "$36,409",
"Clarks Grove": "$30,063",
"Clear Lake": "$28,488",
"Clearbrook": "$20,173",
"Clearwater": "$91,372",
"Clements": "$6,608",
"Cleveland": "$33,214",
"Climax": "$10,415",
"Clinton": "$17,198",
"Clitherall": "$2,757",
"Clontarf": "$5,689",
"Cloquet": "$556,412",
"Coates": "$6,389",
"Cobden": "$1,488",
"Cohasset": "$117,146",
"Cokato": "$123,360",
"Cold Spring": "$184,143",
"Coleraine": "$87,127",
"Cologne": "$90,015",
"Columbia Heights": "$956,556",
"Columbus": "$182,349",
"Comfrey": "$17,023",
"Comstock": "$4,289",
"Conger": "$6,652",
"Cook": "$23,499",
"Coon Rapids": "$2,806,261",
"Corcoran": "$292,669",
"Correll": "$1,138",
"Cosmos": "$22,143",
"Cottage Grove": "$1,733,127",
"Cottonwood": "$50,106",
"Courtland": "$32,470",
"Credit River": "$239,544",
"Cromwell": "$10,634",
"Crookston": "$320,851",
"Crosby": "$104,675",
"Crosslake": "$107,913",
"Crystal": "$1,010,119",
"Currie": "$9,671",
"Cuyuna": "$13,609",
"Cyrus": "$13,784",
"Dakota": "$12,822",
"Dalton": "$9,146",
"Danube": "$19,911",
"Danvers": "$4,551",
"Darfur": "$3,632",
"Darwin": "$15,185",
"Dassel": "$64,984",
"Dawson": "$64,153",
"Dayton": "$351,001",
"De Graff": "$4,901",
"Deephaven": "$170,009",
"Deer Creek": "$14,397",
"Deer River": "$39,428",
"Deerwood": "$23,456",
"Delano": "$291,181",
"Delavan": "$7,439",
"Delhi": "$2,013",
"Dellwood": "$51,331",
"Denham": "$1,619",
"Dennison": "$9,715",
"Dent": "$7,483",
"Detroit Lakes": "$437,165",
"Dexter": "$14,397",
"Dilworth": "$203,004",
"Dodge Center": "$124,586",
"Donaldson": "$875",
"Donnelly": "$9,452",
"Doran": "$1,532",
"Dover": "$34,658",
"Dovray": "$2,494",
"Duluth": "$3,748,814",
"Dumont": "$3,238",
"Dundas": "$78,068",
"Dundee": "$3,151",
"Dunnell": "$5,776",
"Eagan": "$3,023,224",
"Eagle Bend": "$23,674",
"Eagle Lake": "$143,621",
"East Bethel": "$515,978",
"East Grand Forks": "$398,438",
"East Gull Lake": "$45,467",
"Easton": "$7,658",
"Echo": "$10,371",
"Eden Prairie": "$2,806,873",
"Eden Valley": "$44,898",
"Edgerton": "$54,569",
"Edina": "$2,344,327",
"Effie": "$4,726",
"Eitzen": "$12,122",
"Elba": "$5,601",
"Elbow Lake": "$56,057",
"Elgin": "$50,193",
"Elizabeth": "$7,264",
"Elk River": "$1,145,601",
"Elko New Market": "$215,301",
"Elkton": "$5,733",
"Ellendale": "$29,538",
"Ellsworth": "$21,880",
"Elmdale": "$4,945",
"Elmore": "$23,674",
"Elrosa": "$9,496",
"Ely": "$140,427",
"Elysian": "$31,945",
"Emily": "$37,678",
"Emmons": "$15,973",
"Empire township": "$138,283",
"Erhard": "$5,820",
"Erskine": "$17,373",
"Evan": "$3,019",
"Evansville": "$26,431",
"Eveleth": "$151,804",
"Excelsior": "$103,274",
"Eyota": "$88,921",
"Fairfax": "$53,563",
"Fairmont": "$455,851",
"Falcon Heights": "$224,272",
"Faribault": "$1,063,288",
"Farmington": "$1,035,106",
"Farwell": "$2,451",
"Federal Dam": "$5,470",
"Felton": "$7,702",
"Fergus Falls": "$614,482",
"Fertile": "$35,008",
"Fifty Lakes": "$19,823",
"Finlayson": "$13,216",
"Fisher": "$18,204",
"Flensburg": "$9,408",
"Floodwood": "$22,405",
"Florence": "$1,225",
"Foley": "$118,109",
"Forada": "$7,439",
"Forest Lake": "$918,572",
"Foreston": "$24,550",
"Fort Ripley": "$3,720",
"Fosston": "$61,965",
"Fountain": "$17,898",
"Foxhome": "$5,339",
"Franklin": "$21,443",
"Frazee": "$58,157",
"Freeborn": "$11,378",
"Freeport": "$29,845",
"Fridley": "$1,292,504",
"Frost": "$9,365",
"Fulda": "$59,558",
"Funkley": "$788",
"Garfield": "$15,316",
"Garrison": "$8,708",
"Garvin": "$5,383",
"Gary": "$10,152",
"Gaylord": "$101,218",
"Gem Lake": "$23,368",
"Geneva": "$22,230",
"Genola": "$3,063",
"Georgetown": "$3,763",
"Ghent": "$16,410",
"Gibbon": "$34,614",
"Gilbert": "$73,299",
"Gilman": "$9,759",
"Glencoe": "$252,103",
"Glenville": "$25,687",
"Glenwood": "$116,752",
"Glyndon": "$57,457",
"Golden Valley": "$977,343",
"Gonvick": "$11,990",
"Good Thunder": "$24,462",
"Goodhue": "$55,182",
"Goodridge": "$4,726",
"Goodview": "$180,818",
"Graceville": "$23,499",
"Granada": "$12,647",
"Grand Marais": "$58,901",
"Grand Meadow": "$49,887",
"Grand Rapids": "$493,747",
"Granite Falls": "$117,584",
"Grant": "$175,041",
"Grasston": "$6,783",
"Green Isle": "$26,825",
"Greenbush": "$29,757",
"Greenfield": "$127,824",
"Greenwald": "$8,752",
"Greenwood": "$31,682",
"Grey Eagle": "$14,310",
"Grove City": "$27,306",
"Grygla": "$7,833",
"Gully": "$2,669",
"Hackensack": "$13,216",
"Hadley": "$2,407",
"Hallock": "$39,034",
"Halma": "$2,494",
"Halstad": "$24,418",
"Ham Lake": "$721,564",
"Hamburg": "$24,812",
"Hammond": "$5,733",
"Hampton": "$32,426",
"Hancock": "$36,977",
"Hanley Falls": "$10,371",
"Hanover": "$157,975",
"Hanska": "$16,585",
"Harding": "$5,339",
"Hardwick": "$8,227",
"Harmony": "$45,598",
"Harris": "$48,968",
"Hartland": "$13,697",
"Hastings": "$975,986",
"Hatfield": "$2,363",
"Hawley": "$97,498",
"Hayfield": "$59,995",
"Hayward": "$10,940",
"Hazel Run": "$2,363",
"Hector": "$43,979",
"Heidelberg": "$5,995",
"Henderson": "$42,710",
"Hendricks": "$26,650",
"Hendrum": "$12,515",
"Henning": "$37,196",
"Henriette": "$2,582",
"Herman": "$16,891",
"Hermantown": "$438,916",
"Heron Lake": "$26,387",
"Hewitt": "$11,071",
"Hibbing": "$702,965",
"Hill City": "$27,044",
"Hillman": "$1,006",
"Hills": "$30,151",
"Hilltop": "$42,491",
"Hinckley": "$84,282",
"Hitterdal": "$9,102",
"Hoffman": "$30,763",
"Hokah": "$24,243",
"Holdingford": "$32,601",
"Holland": "$7,658",
"Hollandale": "$13,522",
"Holloway": "$3,851",
"Holt": "$3,982",
"Hopkins": "$828,207",
"Houston": "$43,498",
"Howard Lake": "$93,034",
"Hoyt Lakes": "$87,652",
"Hugo": "$703,272",
"Humboldt": "$1,750",
"Hutchinson": "$643,408",
"Ihlen": "$2,757",
"Independence": "$166,070",
"International Falls": "$251,053",
"Inver Grove Heights": "$1,564,124",
"Iona": "$7,089",
"Iron Junction": "$4,770",
"Ironton": "$25,556",
"Isanti": "$307,285",
"Isle": "$35,883",
"Ivanhoe": "$24,024",
"Jackson": "$145,634",
"Janesville": "$106,644",
"Jasper": "$26,300",
"Jeffers": "$15,491",
"Jenkins": "$21,880",
"Johnson": "$1,138",
"Jordan": "$297,658",
"Kandiyohi": "$24,812",
"Karlstad": "$30,588",
"Kasota": "$31,201",
"Kasson": "$302,865",
"Keewatin": "$42,666",
"Kelliher": "$11,334",
"Kellogg": "$18,423",
"Kennedy": "$7,571",
"Kenneth": "$2,626",
"Kensington": "$11,684",
"Kent": "$2,757",
"Kenyon": "$83,670",
"Kerkhoven": "$35,708",
"Kerrick": "$3,107",
"Kettle River": "$7,395",
"Kiester": "$21,136",
"Kilkenny": "$6,608",
"Kimball": "$35,358",
"Kinbrae": "$350",
"Kingston": "$8,008",
"Kinney": "$6,608",
"La Crescent": "$233,374",
"La Prairie": "$28,313",
"La Salle": "$3,413",
"Lafayette": "$21,618",
"Lake Benton": "$29,713",
"Lake Bronson": "$7,658",
"Lake City": "$232,367",
"Lake Crystal": "$111,326",
"Lake Elmo": "$553,787",
"Lake Henry": "$3,151",
"Lake Lillian": "$10,678",
"Lake Park": "$31,901",
"Lake Shore": "$47,261",
"Lake St. Croix Beach": "$45,073",
"Lake Wilson": "$10,984",
"Lakefield": "$76,099",
"Lakeland": "$74,349",
"Lakeland Shores": "$14,835",
"Lakeville": "$3,156,649",
"Lamberton": "$34,352",
"Lancaster": "$15,797",
"Landfall": "$35,752",
"Lanesboro": "$31,639",
"Laporte": "$6,126",
"Lastrup": "$5,207",
"Lauderdale": "$98,329",
"Le Center": "$110,232",
"Le Roy": "$42,360",
"Le Sueur": "$184,712",
"Lengby": "$3,982",
"Leonard": "$1,794",
"Leonidas": "$2,319",
"Lester Prairie": "$83,320",
"Lewiston": "$66,559",
"Lewisville": "$8,927",
"Lexington": "$114,214",
"Lilydale": "$35,140",
"Lindstrom": "$215,301",
"Lino Lakes": "$929,294",
"Lismore": "$8,752",
"Litchfield": "$290,087",
"Little Canada": "$471,123",
"Little Falls": "$398,831",
"Littlefork": "$24,199",
"Long Beach": "$14,922",
"Long Lake": "$75,880",
"Long Prairie": "$162,788",
"Longville": "$6,783",
"Lonsdale": "$209,130",
"Loretto": "$28,313",
"Louisburg": "$1,357",
"Lowry": "$14,572",
"Lucan": "$9,277",
"Luverne": "$216,045",
"Lyle": "$23,062",
"Lynd": "$18,904",
"Mabel": "$31,289",
"Madelia": "$104,500",
"Madison": "$66,472",
"Madison Lake": "$55,050",
"Magnolia": "$8,533",
"Mahnomen": "$54,000",
"Mahtomedi": "$356,690",
"Manchester": "$2,188",
"Manhattan Beach": "$2,713",
"Mankato": "$1,955,560",
"Mantorville": "$48,793",
"Maple Grove": "$3,074,030",
"Maple Lake": "$95,485",
"Maple Plain": "$89,752",
"Mapleton": "$74,436",
"Mapleview": "$6,345",
"Maplewood": "$1,844,015",
"Marble": "$26,738",
"Marietta": "$5,076",
"Marine on St. Croix": "$29,188",
"Marshall": "$595,928",
"Mayer": "$110,539",
"Maynard": "$13,872",
"Mazeppa": "$38,947",
"McGrath": "$1,794",
"McGregor": "$16,935",
"McIntosh": "$26,212",
"McKinley": "$4,464",
"Meadowlands": "$5,820",
"Medford": "$58,989",
"Medicine Lake": "$14,572",
"Medina": "$311,705",
"Meire Grove": "$7,877",
"Melrose": "$158,237",
"Menahga": "$59,033",
"Mendota": "$9,146",
"Mendota Heights": "$509,895",
"Mentor": "$4,507",
"Middle River": "$13,303",
"Miesville": "$6,039",
"Milaca": "$132,769",
"Milan": "$18,467",
"Millerville": "$4,376",
"Millville": "$6,652",
"Milroy": "$11,203",
"Miltona": "$19,123",
"Minneapolis": "$19,007,112",
"Minneiska": "$4,245",
"Minneota": "$59,514",
"Minnesota City": "$8,752",
"Minnesota Lake": "$28,619",
"Minnetonka": "$2,393,864",
"Minnetonka Beach": "$23,937",
"Minnetrista": "$376,032",
"Mizpah": "$2,494",
"Montevideo": "$234,511",
"Montgomery": "$147,735",
"Monticello": "$639,732",
"Montrose": "$167,908",
"Moorhead": "$1,950,966",
"Moose Lake": "$113,908",
"Mora": "$163,357",
"Morgan": "$38,509",
"Morris": "$212,806",
"Morristown": "$41,791",
"Morton": "$17,810",
"Motley": "$29,757",
"Mound": "$411,697",
"Mounds View": "$574,704",
"Mountain Iron": "$125,242",
"Mountain Lake": "$88,702",
"Murdock": "$13,566",
"Myrtle": "$2,144",
"Nashua": "$2,844",
"Nashwauk": "$41,879",
"Nassau": "$2,844",
"Nelson": "$7,964",
"Nerstrand": "$11,947",
"Nevis": "$16,804",
"New Auburn": "$18,117",
"New Brighton": "$1,037,338",
"New Germany": "$20,349",
"New Hope": "$957,038",
"New London": "$55,838",
"New Munich": "$15,754",
"New Prague": "$359,753",
"New Richland": "$53,781",
"New Trier": "$3,763",
"New Ulm": "$615,707",
"New York Mills": "$56,320",
"Newfolden": "$15,360",
"Newport": "$170,228",
"Nicollet": "$50,981",
"Nielsville": "$3,370",
"Nimrod": "$3,632",
"Nisswa": "$88,965",
"Norcross": "$2,276",
"North Branch": "$486,396",
"North Mankato": "$632,818",
"North Oaks": "$232,192",
"North St. Paul": "$542,496",
"Northfield": "$899,143",
"Northome": "$6,695",
"Northrop": "$9,671",
"Norwood Young America": "$174,691",
"Nowthen": "$198,190",
"Oak Grove": "$394,237",
"Oak Park Heights": "$211,362",
"Oakdale": "$1,231,196",
"Odessa": "$4,639",
"Odin": "$5,207",
"Ogema": "$9,015",
"Ogilvie": "$17,154",
"Okabena": "$9,015",
"Oklee": "$18,073",
"Olivia": "$102,137",
"Onamia": "$34,396",
"Ormsby": "$5,207",
"Orono": "$371,306",
"Oronoco": "$79,119",
"Orr": "$9,146",
"Ortonville": "$89,534",
"Osakis": "$77,893",
"Oslo": "$10,371",
"Osseo": "$117,321",
"Ostrander": "$10,109",
"Otsego": "$931,613",
"Ottertail": "$28,138",
"Owatonna": "$1,166,081",
"Palisade": "$7,308",
"Park Rapids": "$185,850",
"Parkers Prairie": "$44,242",
"Paynesville": "$107,169",
"Pease": "$10,459",
"Pelican Rapids": "$111,764",
"Pemberton": "$9,977",
"Pennock": "$20,961",
"Pequot Lakes": "$107,169",
"Perham": "$156,487",
"Perley": "$4,901",
"Peterson": "$10,240",
"Pierz": "$62,008",
"Pillager": "$22,449",
"Pine City": "$138,239",
"Pine Island": "$168,127",
"Pine River": "$40,435",
"Pine Springs": "$16,454",
"Pipestone": "$181,080",
"Plainview": "$153,861",
"Plato": "$14,528",
"Plummer": "$12,165",
"Plymouth": "$3,552,636",
"Porter": "$6,914",
"Preston": "$58,157",
"Princeton": "$223,178",
"Prinsburg": "$22,624",
"Prior Lake": "$1,217,937",
"Proctor": "$135,526",
"Quamba": "$4,726",
"Racine": "$20,217",
"Ramsey": "$1,248,044",
"Randall": "$26,475",
"Randolph": "$21,180",
"Ranier": "$24,856",
"Raymond": "$34,571",
"Red Lake Falls": "$58,595",
"Red Wing": "$725,896",
"Redwood Falls": "$221,733",
"Regal": "$1,882",
"Remer": "$17,504",
"Renville": "$56,538",
"Revere": "$3,851",
"Rice": "$89,840",
"Rice Lake": "$179,461",
"Richfield": "$1,604,296",
"Richmond": "$65,159",
"Richville": "$3,326",
"Riverton": "$5,339",
"Robbinsdale": "$649,315",
"Rochester": "$5,341,601",
"Rock Creek": "$75,662",
"Rockford": "$201,341",
"Rockville": "$104,937",
"Rogers": "$608,487",
"Rollingstone": "$29,669",
"Roosevelt": "$6,652",
"Roscoe": "$5,558",
"Rose Creek": "$17,767",
"Roseau": "$119,422",
"Rosemount": "$1,143,588",
"Roseville": "$1,594,625",
"Rothsay": "$21,311",
"Round Lake": "$16,366",
"Royalton": "$55,838",
"Rush City": "$138,283",
"Rushford": "$81,394",
"Rushford Village": "$34,746",
"Rushmore": "$15,841",
"Russell": "$15,185",
"Ruthton": "$9,802",
"Rutledge": "$9,627",
"Sabin": "$27,000",
"Sacred Heart": "$22,143",
"Sanborn": "$14,003",
"Sandstone": "$97,498",
"Sargeant": "$2,713",
"Sartell": "$854,289",
"Sauk Centre": "$202,348",
"Sauk Rapids": "$600,829",
"Savage": "$1,422,910",
"Scandia": "$176,529",
"Scanlon": "$43,585",
"Seaforth": "$3,545",
"Sebeka": "$32,295",
"Sedan": "$1,969",
"Shafer": "$51,156",
"Shakopee": "$1,995,163",
"Shelly": "$7,746",
"Sherburn": "$46,036",
"Shevlin": "$5,951",
"Shoreview": "$1,180,084",
"Shorewood": "$342,512",
"Silver Bay": "$81,482",
"Silver Lake": "$38,115",
"Skyline": "$12,515",
"Slayton": "$87,346",
"Sleepy Eye": "$150,142",
"Sobieski": "$9,146",
"Solway": "$3,413",
"South Haven": "$8,096",
"South St. Paul": "$907,807",
"Spicer": "$48,443",
"Spring Grove": "$54,700",
"Spring Hill": "$2,976",
"Spring Lake Park": "$330,128",
"Spring Park": "$75,968",
"Spring Valley": "$107,432",
"Springfield": "$88,046",
"Squaw Lake": "$4,376",
"St. Anthony": "$3,982",
"St. Anthony": "$401,501",
"St. Augusta": "$155,743",
"St. Bonifacius": "$100,474",
"St. Charles": "$174,210",
"St. Clair": "$32,645",
"St. Cloud": "$3,008,346",
"St. Francis": "$362,860",
"St. Hilaire": "$11,553",
"St. James": "$207,818",
"St. Joseph": "$312,930",
"St. Leo": "$3,982",
"St. Louis Park": "$2,194,317",
"St. Martin": "$13,697",
"St. Marys Point": "$15,316",
"St. Michael": "$832,715",
"St. Paul": "$13,654,964",
"St. Paul Park": "$240,988",
"St. Peter": "$528,012",
"St. Rosa": "$2,538",
"St. Stephen": "$35,096",
"St. Vincent": "$2,451",
"Stacy": "$74,743",
"Staples": "$129,399",
"Starbuck": "$60,214",
"Steen": "$7,439",
"Stephen": "$25,731",
"Stewart": "$21,399",
"Stewartville": "$299,758",
"Stillwater": "$851,750",
"Stockton": "$35,271",
"Storden": "$9,977",
"Strandquist": "$3,107",
"Strathcona": "$1,094",
"Sturgeon Lake": "$19,386",
"Sunburg": "$4,070",
"Sunfish Lake": "$23,062",
"Swanville": "$14,485",
"Taconite": "$28,225",
"Tamarack": "$2,713",
"Taopi": "$2,713",
"Taunton": "$5,908",
"Taylors Falls": "$46,692",
"Tenstrike": "$8,139",
"Thief River Falls": "$378,395",
"Tintah": "$2,888",
"Tonka Bay": "$62,709",
"Tower": "$18,642",
"Tracy": "$90,365",
"Trail": "$1,707",
"Trimont": "$30,632",
"Trommald": "$4,507",
"Trosky": "$4,201",
"Truman": "$47,436",
"Turtle River": "$3,851",
"Twin Lakes": "$5,820",
"Twin Valley": "$31,376",
"Two Harbors": "$158,894",
"Tyler": "$49,055",
"Ulen": "$21,180",
"Underwood": "$15,710",
"Upsala": "$21,180",
"Urbank": "$2,276",
"Utica": "$11,553",
"Vadnais Heights": "$572,385",
"Vergas": "$15,272",
"Vermillion": "$19,211",
"Verndale": "$22,186",
"Vernon Center": "$14,266",
"Vesta": "$11,947",
"Victoria": "$479,963",
"Viking": "$3,326",
"Villard": "$9,890",
"Vining": "$2,888",
"Virginia": "$364,567",
"Wabasha": "$113,339",
"Wabasso": "$32,120",
"Waconia": "$581,881",
"Wadena": "$188,651",
"Wahkon": "$10,502",
"Waite Park": "$366,186",
"Waldorf": "$8,752",
"Walker": "$42,885",
"Walnut Grove": "$32,558",
"Walters": "$2,888",
"Waltham": "$7,395",
"Wanamingo": "$50,018",
"Wanda": "$3,282",
"Warba": "$7,220",
"Warren": "$69,666",
"Warroad": "$79,775",
"Waseca": "$403,514",
"Watertown": "$210,881",
"Waterville": "$76,756",
"Watkins": "$45,248",
"Watson": "$7,921",
"Waubun": "$17,942",
"Waverly": "$87,477",
"Wayzata": "$196,090",
"Welcome": "$30,807",
"Wells": "$104,412",
"Wendell": "$7,308",
"West Concord": "$37,590",
"West St. Paul": "$913,803",
"West Union": "$3,982",
"Westbrook": "$33,783",
"Westport": "$1,925",
"Whalan": "$3,019",
"Wheaton": "$63,015",
"White Bear Lake": "$1,096,939",
"White Bear township": "$480,707",
"Wilder": "$2,713",
"Willernie": "$22,712",
"Williams": "$7,833",
"Willmar": "$922,292",
"Willow River": "$17,198",
"Wilmont": "$14,397",
"Wilton": "$11,728",
"Windom": "$213,025",
"Winger": "$7,614",
"Winnebago": "$60,258",
"Winona": "$1,111,730",
"Winsted": "$98,111",
"Winthrop": "$58,639",
"Winton": "$7,308",
"Wolf Lake": "$3,063",
"Wolverton": "$5,426",
"Wood Lake": "$16,279",
"Woodbury": "$3,313,661",
"Woodland": "$17,067",
"Woodstock": "$4,814",
"Worthington": "$606,562",
"Wrenshall": "$19,298",
"Wright": "$7,527",
"Wykoff": "$18,992",
"Wyoming": "$353,146",
"Zemple": "$3,370",
"Zimmerman": "$279,322",
"Zumbro Falls": "$6,827",
"Zumbrota": "$165,458"
    
    

};

// Fetch GeoJSON
fetch("MinnesotaMunicipalities.json")
  .then(res => res.json())
  .then(data => {
    console.log("GeoJSON loaded:", data);

    // Create VectorGrid layer
    const vectorLayer = L.vectorGrid.slicer(data, {
      rendererFactory: L.canvas.tile,
      interactive: true,
      getFeatureId: f => f.properties.geoid20,
      vectorTileLayerStyles: {
        sliced: feature => ({
          weight: 1,
          color: "#102f4f",   // dark blue border
          fillColor: "#102f4f",
          fillOpacity: 0       // transparent fill
        })
      }
    }).addTo(map);

    // Tooltip
    const tooltip = L.tooltip({ permanent: false, sticky: true });
    let lastHoveredId = null;

    // Hover effect (mousemove for instant response)
    vectorLayer.on('mousemove', e => {
      const layerId = e.layer.properties.geoid20;
      const name = e.layer.properties.name20;
      if (!name) return;

      // Reset previous hovered polygon immediately
      if (lastHoveredId && lastHoveredId !== layerId) {
        const lastLayer = vectorLayer.getFeatureById(lastHoveredId);
        if (lastLayer) vectorLayer.resetFeatureStyle(lastLayer);
      }

      // Highlight current polygon
      e.layer.setStyle({ weight: 2, color: "#ff9900" });

      // Tooltip content includes aid data if available
      const aidAmount = aidData[name] ? `Public Safety Aid: ${aidData[name]}` : "No aid data";
      tooltip.setContent(`${name}<br>${aidAmount}`);
      tooltip.setLatLng(e.latlng);
      tooltip.addTo(map);

      lastHoveredId = layerId;
    });

    vectorLayer.on('mouseout', e => {
      vectorLayer.resetFeatureStyle(e.layer);
      map.removeLayer(tooltip);
      lastHoveredId = null;
    });

    // Fit map to bounds of all polygons
    const bounds = L.geoJSON(data).getBounds();
    map.fitBounds(bounds);

    console.log("✅ VectorGrid polygons added with instant hover tooltip and aid data");
  })
  .catch(err => console.error("❌ Error loading GeoJSON:", err));


